<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Variational Alpha Terminal</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #020617;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(30, 58, 138, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(79, 70, 229, 0.1) 0%, transparent 50%);
            min-height: 100vh;
            color: #f8fafc;
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        
        .card-pro { 
            position: relative; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            border-left: 2px solid rgba(99, 102, 241, 0.3);
        }
        .card-pro:hover {
            transform: translateY(-4px);
            background: rgba(30, 41, 59, 0.5);
            border-left-color: #818cf8;
            box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.5), 0 0 15px rgba(99, 102, 241, 0.1);
        }

        .text-gradient-custom { 
            background: linear-gradient(to bottom right, #ffffff 20%, #818cf8 50%, #4f46e5 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.4));
            transition: all 0.3s ease;
        }
        .title-container:hover .text-gradient-custom {
            filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.7));
            transform: scale(1.02);
        }
        
        .filter-field {
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .filter-field:focus-within, .filter-field:hover {
            border-bottom-color: #6366f1;
            background: rgba(99, 102, 241, 0.05);
        }

        @keyframes flashUpdate {
            0% { background: rgba(255, 255, 255, 0); }
            50% { background: rgba(255, 255, 255, 0.05); }
            100% { background: rgba(255, 255, 255, 0); }
        }
        .animate-flash { animation: flashUpdate 1s ease-out; }
        
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        .scanline { width: 100%; height: 2px; background: rgba(99, 102, 241, 0.1); position: absolute; animation: scan 4s linear infinite; pointer-events: none; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        
        .swipe-actions {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            z-index: 20;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.95), rgba(99, 102, 241, 0.95));
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .swipe-actions.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .particles {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
        }
        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(100px, -100px); }
            50% { transform: translate(-50px, -200px); }
            75% { transform: translate(-100px, -100px); }
        }
    </style>
</head>
<body>
    <div class="particles">
        <div class="particle" style="left: 10%; top: 20%; animation-delay: 0s;"></div>
        <div class="particle" style="left: 80%; top: 30%; animation-delay: 2s;"></div>
        <div class="particle" style="left: 50%; top: 60%; animation-delay: 4s;"></div>
        <div class="particle" style="left: 20%; top: 80%; animation-delay: 6s;"></div>
        <div class="particle" style="left: 70%; top: 10%; animation-delay: 8s;"></div>
        <div class="particle" style="left: 40%; top: 40%; animation-delay: 10s;"></div>
        <div class="particle" style="left: 90%; top: 70%; animation-delay: 12s;"></div>
        <div class="particle" style="left: 15%; top: 50%; animation-delay: 14s;"></div>
    </div>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const AnimatedNumber = ({ value, decimals = 0, prefix = "", suffix = "" }) => {
          const [displayValue, setDisplayValue] = useState(value);
          const prevValue = useRef(value);

          useEffect(() => {
            if (prevValue.current === value) return;
            const start = prevValue.current;
            const end = value;
            const duration = 800;
            const startTime = Date.now();

            const animate = () => {
              const elapsed = Date.now() - startTime;
              const progress = Math.min(elapsed / duration, 1);
              const eased = 1 - Math.pow(1 - progress, 3);
              const current = start + (end - start) * eased;
              setDisplayValue(current);

              if (progress < 1) requestAnimationFrame(animate);
              else prevValue.current = end;
            };
            requestAnimationFrame(animate);
          }, [value]);

          const formatted = decimals > 0 ? displayValue.toFixed(decimals) : Math.round(displayValue).toLocaleString();
          return <span>{prefix}{formatted}{suffix}</span>;
        };

        const Dashboard = () => {
          const [rawListings, setRawListings] = useState([]);
          const [loading, setLoading] = useState(true);
          const [lastUpdate, setLastUpdate] = useState(null);
          const [flash, setFlash] = useState(false);
          const [inputMin, setInputMin] = useState(0.001);
          const [inputMax, setInputMax] = useState(1);
          const [searchTerm, setSearchTerm] = useState("");
          const [activeRange, setActiveRange] = useState({ min: inputMin, max: inputMax });
          const [touchStart, setTouchStart] = useState(null);
          const [touchEnd, setTouchEnd] = useState(null);
          const [swipedItem, setSwipedItem] = useState(null);

          const fetchData = async () => {
            setLoading(true);
            try {
              const resp = await fetch("https://omni-client-api.prod.ap-northeast-1.variational.io/metadata/stats");
              const json = await resp.json();
              setRawListings(json.listings || []);
              setLastUpdate(new Date());
              setFlash(true);
              setTimeout(() => setFlash(false), 1000);
            } catch (e) { console.error(e); }
            setLoading(false);
          };

          useEffect(() => {
            fetchData();
            const itv = setInterval(fetchData, 30000);
            return () => clearInterval(itv);
          }, []);

          const processedData = useMemo(() => {
            const data = rawListings
              .map(l => {
                const vol = parseFloat(l.volume_24h || 0);
                const oi = (parseFloat(l.open_interest?.long_open_interest || 0) + 
                            parseFloat(l.open_interest?.short_open_interest || 0));
                const spread = parseFloat(l.base_spread_bps || 0)/200;
                const price = parseFloat(l.mark_price || 0);
                const alphaScore = (oi > 0 && spread > 0) ? (1 / (oi * spread)) * 1000000 : 0;
                return { ticker: l.ticker, vol, oi, spread, price, alphaScore };
              })
              .filter(i => 
                i.oi > 100 &&
                i.spread >= activeRange.min && 
                i.spread <= activeRange.max &&
                i.ticker.toLowerCase().includes(searchTerm.toLowerCase())
              )
              .sort((a, b) => b.alphaScore - a.alphaScore);

            const top10 = data.slice(0, 10);
            const maxAlpha = data.length > 0 ? data[0].alphaScore : 1;
            return {
              top10: top10.map(item => ({...item, intensity: (item.alphaScore / maxAlpha) * 100})),
              all: data.map(item => ({...item, intensity: (item.alphaScore / maxAlpha) * 100}))
            };
          }, [rawListings, activeRange, searchTerm]);

          const getScoreColor = (intensity) => {
              if (intensity > 80) return "text-cyan-400";
              if (intensity > 40) return "text-indigo-400";
              return "text-slate-400";
          };

          const handleTouchStart = (e) => {
            setTouchEnd(null);
            setTouchStart(e.targetTouches[0].clientX);
          };

          const handleTouchMove = (e) => {
            setTouchEnd(e.targetTouches[0].clientX);
          };

          const handleTouchEnd = (ticker) => {
            if (!touchStart || !touchEnd) return;
            const distance = touchStart - touchEnd;
            const isLeftSwipe = distance > 50;
            const isRightSwipe = distance < -50;

            if (isLeftSwipe || isRightSwipe) {
              setSwipedItem(swipedItem === ticker ? null : ticker);
            }
          };

          return (
            <div className="max-w-[1100px] mx-auto p-4 md:p-12 relative z-10">
              <div className="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 mb-12 border-b border-white/5 pb-8">
                <div className="title-container cursor-default transition-transform duration-300">
                    <div className="flex items-center gap-3 mb-2">
                        <div className="w-2 h-8 bg-indigo-500 rounded-full shadow-[0_0_15px_rgba(99,102,241,0.5)]"></div>
                        <h1 className="text-3xl md:text-5xl font-extrabold tracking-tighter uppercase text-gradient-custom">Variational Alpha Terminal</h1>
                    </div>
                    <p className="text-slate-500 font-bold text-[9px] md:text-[10px] uppercase tracking-[0.4em] ml-5">Top 10 Ranking by Spread & Open Interest</p>
                </div>
                <div className="flex flex-col items-end gap-2 w-full md:w-auto">
                  <div className="flex items-center gap-4 bg-slate-900/50 p-2 rounded-lg border border-white/5 hover:border-indigo-500/30 transition-all w-full md:w-auto justify-between md:justify-end">
                    {lastUpdate && <span className="text-[10px] mono text-indigo-400 font-bold px-2 uppercase tracking-widest">Update: {lastUpdate.toLocaleTimeString()}</span>}
                    <button onClick={fetchData} className={`p-1.5 hover:text-indigo-400 hover:bg-white/5 rounded transition-all ${loading ? 'animate-spin text-indigo-400' : 'text-slate-400'}`}>
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    </button>
                  </div>
                  <div className="glass rounded px-3 py-1">
                    <span className="text-[9px] font-black text-cyan-400 mono uppercase tracking-wider">
                      {processedData.all.length} Assets
                    </span>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-12">
                <div className="md:col-span-3 glass rounded-xl p-4 flex flex-wrap items-center gap-4 md:gap-8 relative overflow-hidden shadow-inner">
                    <div className="scanline"></div>
                    <div className="flex flex-col filter-field px-2 py-1 rounded w-full md:w-auto">
                        <label className="text-[10px] font-black text-slate-500 uppercase mb-1">Search</label>
                        <input type="text" placeholder="" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="bg-transparent text-white mono text-lg outline-none w-full md:w-32 placeholder:text-slate-700 transition-colors uppercase" />
                    </div>
                    <div className="flex flex-col filter-field px-2 py-1 rounded w-[45%] md:w-auto">
                        <label className="text-[10px] font-black text-slate-500 uppercase mb-1">Min Spread (%)</label>
                        <input type="number" step="0.001" value={inputMin} onChange={e => setInputMin(Number(e.target.value))} className="bg-transparent text-white mono text-lg outline-none w-full md:w-32 transition-colors" />
                    </div>
                    <div className="flex flex-col filter-field px-2 py-1 rounded w-[45%] md:w-auto">
                        <label className="text-[10px] font-black text-slate-500 uppercase mb-1">Max Spread (%)</label>
                        <input type="number" step="0.001" value={inputMax} onChange={e => setInputMax(Number(e.target.value))} className="bg-transparent text-white mono text-lg outline-none w-full md:w-32 transition-colors" />
                    </div>
                    <button 
                        onClick={() => setActiveRange({ min: inputMin, max: inputMax })} 
                        className="w-full md:w-auto md:ml-auto bg-white text-black font-black text-[10px] px-8 py-3.5 rounded hover:bg-indigo-500 hover:text-white hover:shadow-[0_0_20px_rgba(99,102,241,0.4)] transition-all uppercase tracking-widest active:scale-95 shadow-lg"
                    >
                        Apply
                    </button>
                </div>
                <div className="glass rounded-xl p-4 flex flex-row md:flex-col justify-center items-center border-indigo-500/10 group cursor-help transition-all hover:border-indigo-500/40 gap-3 md:gap-0">
                    <div className="text-[10px] font-bold text-slate-500 uppercase mb-1 tracking-tighter">STATUS</div>
                    <div className="flex items-center gap-2">
                        <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)] group-hover:shadow-[0_0_12px_rgba(34,197,94,1)] transition-all"></span>
                        <span className="text-green-400 font-black mono text-xs uppercase italic">ACTIVE</span>
                    </div>
                </div>
              </div>

              <div className="space-y-3">
                {processedData.top10.length === 0 ? (
                    <div className="glass rounded-xl p-20 text-center text-slate-500 uppercase mono text-sm tracking-[0.3em]">No Assets Found</div>
                ) : processedData.top10.map((item, idx) => (
                    <div 
                      key={item.ticker} 
                      className={`glass rounded-xl p-5 card-pro overflow-hidden group relative ${flash ? 'animate-flash' : ''}`}
                      onTouchStart={handleTouchStart}
                      onTouchMove={handleTouchMove}
                      onTouchEnd={() => handleTouchEnd(item.ticker)}
                    >
                        <div className={`swipe-actions ${swipedItem === item.ticker ? 'active' : ''}`}>
                          <button 
                            onClick={() => setSwipedItem(null)}
                            className="text-white font-black text-sm uppercase px-6 py-3 bg-cyan-500 rounded-lg active:scale-95 shadow-lg"
                          >
                            ‚≠ê Watch
                          </button>
                          <button 
                            onClick={() => setSwipedItem(null)}
                            className="text-white font-black text-sm uppercase px-6 py-3 bg-slate-700 rounded-lg active:scale-95 shadow-lg"
                          >
                            üìä Details
                          </button>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-12 gap-4 md:gap-6 items-center relative z-10">
                            <div className="md:col-span-2">
                                <span className="text-2xl md:text-3xl font-black tracking-tighter text-white group-hover:text-indigo-400 transition-all duration-300 leading-none inline-block group-hover:translate-x-1">{item.ticker}</span>
                            </div>

                            <div className="md:col-span-6 grid grid-cols-3 md:grid-cols-4 gap-2 border-l border-white/5 pl-4 md:pl-6">
                                <div className="flex flex-col hover:translate-y-[-2px] transition-transform">
                                    <span className="text-[9px] font-bold text-slate-500 uppercase mb-1">Price</span>
                                    <span className="text-sm font-bold text-indigo-400 mono">
                                      <AnimatedNumber 
                                        value={item.price} 
                                        decimals={item.price >= 1000 ? 0 : item.price >= 1 ? 2 : item.price >= 0.01 ? 4 : 6} 
                                        prefix="$" 
                                      />
                                    </span>
                                </div>
                                <div className="flex flex-col hover:translate-y-[-2px] transition-transform">
                                    <span className="text-[9px] font-bold text-slate-500 uppercase mb-1">Spread</span>
                                    <span className="text-sm font-bold text-slate-300 mono">
                                      <AnimatedNumber value={item.spread} decimals={4} suffix="%" />
                                    </span>
                                </div>
                                <div className="flex flex-col hover:translate-y-[-2px] transition-transform">
                                    <span className="text-[9px] font-bold text-slate-500 uppercase mb-1">OI</span>
                                    <span className="text-sm font-bold text-slate-300 mono">
                                      ${item.oi >= 1000000 ? <><AnimatedNumber value={item.oi/1000000} decimals={1} />M</> : <AnimatedNumber value={item.oi} decimals={0} />}
                                    </span>
                                </div>
                                <div className="hidden md:flex flex-col hover:translate-y-[-2px] transition-transform">
                                    <span className="text-[9px] font-bold text-slate-500 uppercase mb-1">Volume</span>
                                    <span className="text-sm font-bold text-slate-300 mono">
                                      ${item.vol >= 1000000 ? <><AnimatedNumber value={item.vol/1000000} decimals={1} />M</> : <AnimatedNumber value={item.vol} decimals={0} />}
                                    </span>
                                </div>
                            </div>

                            <div className="md:col-span-4 flex flex-row md:flex-col items-center md:items-end justify-between md:justify-center border-t md:border-t-0 border-white/5 pt-4 md:pt-0">
                                <div className="flex flex-col items-start md:items-end mb-0 md:mb-2 group-hover:scale-105 transition-transform duration-300 origin-right">
                                    <span className="text-[9px] font-black text-slate-500 uppercase tracking-widest">Alpha Score</span>
                                    <span className={`text-3xl md:text-4xl font-black mono leading-none tracking-tighter transition-colors duration-500 ${getScoreColor(item.intensity)}`}>
                                        <AnimatedNumber value={item.alphaScore} decimals={0} />
                                    </span>
                                </div>
                                <div className="w-24 md:w-full md:max-w-[160px] h-1 bg-white/5 rounded-full overflow-hidden">
                                    <div 
                                        className={`h-full transition-all duration-1000 ${item.intensity > 80 ? 'bg-cyan-500 shadow-[0_0_12px_rgba(6,182,212,0.8)]' : 'bg-indigo-500'}`}
                                        style={{ width: `${item.intensity}%` }}
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>
                ))}
              </div>
            </div>
          );
        };

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
